<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutri365 - Your AI Meal Planner</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        :root {
            --hpb-blue: #0072BC;
            --hpb-red: #ED1C24;
            --hpb-green: #00A651;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .custom-tab {
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .custom-tab.active {
            border-bottom: 3px solid var(--hpb-blue);
            color: var(--hpb-blue);
        }

        .loading-spinner {
            display: none;
        }

        .loading-spinner.show {
            display: flex;
        }

        .custom-button {
            background-color: var(--hpb-blue);
            transition: all 0.3s ease;
        }

        .custom-button:hover {
            background-color: #005a94;
        }

        .checkbox-container {
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            padding: 0.5rem;
            margin: 0.5rem 0;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8 flex items-center justify-between">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-900">Nutri365</h1>
                </div>
                <img src={{url_for('static', filename='healthy365logo.png')}}
      alt="Healthy365 Logo" class="h-12 w-auto">
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <!-- Tabs -->
            <div class="border-b border-gray-200 mb-8">
                <nav class="flex space-x-8" aria-label="Tabs">
                    <button class="custom-tab active px-3 py-2 text-sm font-medium" data-tab="health-info">Health Information</button>
                    <button class="custom-tab px-3 py-2 text-sm font-medium" data-tab="nutrition-analysis">Nutrition Analysis</button>
                    <button class="custom-tab px-3 py-2 text-sm font-medium" data-tab="image-upload">Image Upload</button>
                    <button class="custom-tab px-3 py-2 text-sm font-medium" data-tab="meal-suggestion">Meal Suggestion</button>
                    <button class="custom-tab px-3 py-2 text-sm font-medium" data-tab="dietary-advice">Dietary Advice</button>
                    <button class="custom-tab px-3 py-2 text-sm font-medium" data-tab="meal-plan">Meal Plan</button>
                </nav>
            </div>

            <!-- Tab Contents -->
            <div class="space-y-8">
                <!-- Health Information -->
                <div id="health-info" class="tab-content active">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold mb-6">Enter Your Health Information</h2>
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Age</label>
                                <input type="number" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Gender</label>
                                <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option>Select your gender</option>
                                    <option>Male</option>
                                    <option>Female</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Weight (kg)</label>
                                <input type="number" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Height (cm)</label>
                                <input type="number" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Health Conditions</label>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Diabetes</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">High Blood Pressure</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Heart Disease</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">High Cholesterol</span>
                                </label>
                            </div>
                        </div>
                        <button class="custom-button mt-6 px-4 py-2 text-white rounded-md">Save Health Information</button>
                        <div id="health-info-result" class="mt-6"></div>
                    </div>
                </div>

                <!-- Nutrition Analysis -->
                <div id="nutrition-analysis" class="tab-content">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold mb-6">Analyze Meal's Nutrition</h2>
                        <div class="max-w-xl">
                            <input type="text" placeholder="Search for a local dish" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <button class="custom-button mt-4 px-4 py-2 text-white rounded-md">Analyze Nutrition</button>
                        </div>
                        <div id="nutrition-analysis-result" class="mt-6"></div>
                    </div>
                </div>

                <!-- Image Upload -->
                <div id="image-upload" class="tab-content">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold mb-6">Upload Food Image for Nutritional Analysis</h2>
                        <div class="max-w-xl">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Choose an image of food</label>
                            <input type="file" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                            <button class="custom-button mt-4 px-4 py-2 text-white rounded-md">Upload and Analyze</button>
                        </div>
                        <div id="image-analysis-result" class="mt-6"></div>
                    </div>
                </div>

                <!-- Meal Suggestion -->
                <div id="meal-suggestion" class="tab-content">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold mb-6">Get a Meal Suggestion</h2>
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Food Preferences</label>
                                <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option>Select your preference</option>
                                    <option>Vegetarian</option>
                                    <option>Vegan</option>
                                    <option>Pescatarian</option>
                                    <option>Omnivore</option>
                                    <option>Keto</option>
                                    <option>Paleo</option>
                                    <option>Low Carb</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Health Goal</label>
                                <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option>Select your goal</option>
                                    <option>Weight Loss</option>
                                    <option>Muscle Gain</option>
                                    <option>Maintenance</option>
                                    <option>Energy Boost</option>
                                    <option>Balanced Diet</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Meal Type</label>
                                <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option>Select meal type</option>
                                    <option>Breakfast</option>
                                    <option>Lunch</option>
                                    <option>Dinner</option>
                                    <option>Snack</option>
                                    <option>Dessert</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Cuisine Preference</label>
                                <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option>Select cuisine</option>
                                    <option>Asian</option>
                                    <option>Mediterranean</option>
                                    <option>Italian</option>
                                    <option>Mexican</option>
                                    <option>American</option>
                                    <option>Indian</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Dietary Restrictions</label>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Gluten-Free</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Dairy-Free</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Nut-Free</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Soy-Free</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Egg-Free</span>
                                </label>
                            </div>
                        </div>
                        <button class="custom-button mt-6 px-4 py-2 text-white rounded-md">Get Meal Suggestion</button>
                        <div id="meal-suggestion-result" class="mt-6"></div>
                    </div>
                </div>

                <!-- Dietary Advice -->
                <div id="dietary-advice" class="tab-content">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold mb-6">Get Dietary Advice</h2>
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Current Diet</label>
                                <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option>Select your current diet</option>
                                    <option>Vegetarian</option>
                                    <option>Vegan</option>
                                    <option>Pescatarian</option>
                                    <option>Omnivore</option>
                                    <option>Keto</option>
                                    <option>Paleo</option>
                                    <option>Low Carb</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Activity Level</label>
                                <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option>Select your activity level</option>
                                    <option>Sedentary (Little or no exercise)</option>
                                    <option>Lightly Active (Light exercise/sports 1-3 days a week)</option>
                                    <option>Moderately Active (Moderate exercise/sports 3-5 days a week)</option>
                                    <option>Very Active (Hard exercise/sports 6-7 days a week)</option>
                                    <option>Extra Active (Very hard exercise/sports or a physical job)</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Preferred Meal Types</label>
                            <div class="grid grid-cols-2 gap-4 sm:grid-cols-3">
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Breakfast</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Lunch</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Dinner</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Snack</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Dessert</span>
                                </label>
                            </div>
                        </div>
                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Allergies or Intolerances</label>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Gluten-Free</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Dairy-Free</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Nut-Free</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Soy-Free</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Egg-Free</span>
                                </label>
                            </div>
                        </div>
                        <button class="custom-button mt-6 px-4 py-2 text-white rounded-md">Get Dietary Advice</button>
                        <div id="dietary-advice-result" class="mt-6"></div>
                    </div>
                </div>

                <!-- Meal Plan -->
                <div id="meal-plan" class="tab-content">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-xl font-semibold mb-6">Create a Meal Plan</h2>
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Food Preferences</label>
                                <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option>Select your preference</option>
                                    <option>Vegetarian</option>
                                    <option>Vegan</option>
                                    <option>Pescatarian</option>
                                    <option>Omnivore</option>
                                    <option>Keto</option>
                                    <option>Paleo</option>
                                    <option>Low Carb</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Health Goal</label>
                                <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option>Select your health goal</option>
                                    <option>Weight Loss</option>
                                    <option>Muscle Gain</option>
                                    <option>Maintenance</option>
                                    <option>Energy Boost</option>
                                    <option>Balanced Diet</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Activity Level</label>
                                <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    <option>Select your activity level</option>
                                    <option>Sedentary (Little or no exercise)</option>
                                    <option>Lightly Active (Light exercise/sports 1-3 days a week)</option>
                                    <option>Moderately Active (Moderate exercise/sports 3-5 days a week)</option>
                                    <option>Very Active (Hard exercise/sports 6-7 days a week)</option>
                                    <option>Extra Active (Very hard exercise/sports or a physical job)</option>
                                </select>
                            </div>
                        </div>

                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Preferred Cuisines</label>
                            <div class="grid grid-cols-2 gap-4 sm:grid-cols-3">
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Asian</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Mediterranean</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Italian</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Mexican</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">American</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Indian</span>
                                </label>
                            </div>
                        </div>

                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Dietary Restrictions</label>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Gluten-Free</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Dairy-Free</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Nut-Free</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Soy-Free</span>
                                </label>
                                <label class="checkbox-container flex items-center">
                                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 mr-2">
                                    <span class="text-sm text-gray-700">Egg-Free</span>
                                </label>
                            </div>
                        </div>

                        <button class="custom-button mt-6 px-4 py-2 text-white rounded-md">Create Meal Plan</button>
                        <div id="meal-plan-result" class="mt-6"></div>
                    </div>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div class="loading-spinner fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center">
                <div class="bg-white p-6 rounded-lg shadow-xl">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
                    <p class="mt-4 text-gray-700 text-center">Loading...</p>
                </div>
            </div>
        </main>
    </div>
    
    <!-- JavaScript to handle form submissions and display results -->
    <script>
      // Function to show/hide the loading indicator
      function toggleLoading(show) {
        const loadingSpinner = document.querySelector(".loading-spinner");

        // Check if the loading spinner exists
        if (loadingSpinner) {
          loadingSpinner.style.display = show ? "block" : "none";
        } else {
          console.warn("Loading spinner element not found.");
        }
      }
      // Tab switching logic
      document.querySelectorAll('.custom-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and content
                document.querySelectorAll('.custom-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

      // Function to handle API requests and update the result
      async function handleFormSubmission(
        formId,
        apiEndpoint,
        resultDivId,
        inputData
      ) {
        const form = document.getElementById(formId);
        const resultDiv = document.getElementById(resultDivId);

        form.addEventListener("submit", async (event) => {
          event.preventDefault();

          // Show loading indicator
          toggleLoading(true);

          const data = {};
          inputData.forEach((idOrName) => {
            const inputField = document.getElementById(idOrName);

            if (!inputField) {
              const checkboxes = document.querySelectorAll(
                `input[name="${idOrName}"]:checked`
              );
              if (checkboxes.length > 0) {
                data[idOrName] = Array.from(checkboxes).map(
                  (checkbox) => checkbox.value
                );
              } else {
                console.warn(
                  `Element with ID or name '${idOrName}' not found.`
                );
              }
            } else if (inputField.type === "checkbox") {
              data[idOrName] = inputField.checked ? inputField.value : "";
            } else if (inputField.tagName === "SELECT" && inputField.multiple) {
              data[idOrName] = Array.from(inputField.selectedOptions).map(
                (option) => option.value
              );
            } else {
              data[idOrName] = inputField.value;
            }
          });

          // Get health information if needed
          const healthInfo = getHealthInfo();
          if (healthInfo) {
            data.health_info = healthInfo;
          }

          console.log(data);

          try {
            const response = await fetch(apiEndpoint, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            });
            console.log(response);
            const result = await response.json();
            // Hide loading indicator
            toggleLoading(false);
            if (result.error) {
              resultDiv.innerHTML = `<p style="color:red;">Error: ${result.error}</p>`;
            } else {
              resultDiv.innerHTML = `<p><strong>Result:</strong> ${JSON.stringify(
                result
              )}</p>`;
            }
          } catch (error) {
            // Hide loading indicator
            toggleLoading(false);
            resultDiv.innerHTML = `<p style="color:red;">Error: ${error.message}</p>`;
          }
        });
      }

      // Function to handle image upload, display the image preview, and make API call
      document
        .getElementById("food-image")
        .addEventListener("change", function (event) {
          const file = event.target.files[0];
          if (file) {
            // Display the image preview
            const preview = document.getElementById("image-preview");
            const reader = new FileReader();

            reader.onload = function (e) {
              preview.src = e.target.result;
              preview.style.display = "block"; // Show the image preview
            };

            reader.readAsDataURL(file); // Convert the image file to a data URL
          }
        });
      // Function to handle image upload and API call
      document
        .getElementById("image-upload-form")
        .addEventListener("submit", async (event) => {
          event.preventDefault();

           // Show loading indicator
           toggleLoading(true);

          const fileInput = document.getElementById("food-image");
          const file = fileInput.files[0];

          // Read the image as Base64
          const reader = new FileReader();
          reader.onload = async function () {
            const base64Image = reader.result.split(",")[1]; // Remove the base64 prefix

            try {
              const response = await fetch("/api/image_analysis", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ image: base64Image }),
              });
              const result = await response.json();
              toggleLoading(false); // Hide loading indicator
              const resultDiv = document.getElementById(
                "image-analysis-result"
              );

              if (result.error) {
                resultDiv.innerHTML = `<p style="color:red;">Error: ${result.error}</p>`;
              } else {
                // Display the analysis result
                resultDiv.innerHTML = `<p><strong>Nutrition Facts:</strong> ${JSON.stringify(
                  result.nutritional_facts
                )}</p>`;
              }
            } catch (error) {
              // Hide loading indicator
              toggleLoading(false);
              resultDiv.innerHTML = `<p style="color:red;">Error: ${error.message}</p>`;
            }
          };

          reader.readAsDataURL(file); // Convert image to Base64
        });

      // Save health information to local storage
      document
        .getElementById("health-info-form")
        .addEventListener("submit", (event) => {
          event.preventDefault();

          // Gather health data
          const healthData = {
            age: document.getElementById("age").value,
            gender: document.getElementById("gender").value,
            weight: document.getElementById("weight").value,
            height: document.getElementById("height").value,
            health_conditions: Array.from(
              document.querySelectorAll(
                'input[name="health_conditions"]:checked'
              )
            ).map((checkbox) => checkbox.value),
            include_health: document.getElementById("include_health").checked,
          };

          // Save health information to localStorage
          localStorage.setItem("healthInfo", JSON.stringify(healthData));

          // Show a message based on the inclusion checkbox
          const message = healthData.include_health
            ? "Health information saved! It will be taken into account for your meal and dietary planning."
            : "Health information saved! It will not be used in your meal and dietary planning.";

          const color = healthData.include_health ? "green" : "red";

          // Update the result div with the message and color
          document.getElementById(
            "health-info-result"
          ).innerHTML = `<p style="color:${color};">${message}</p>`;
        });

      // Function to get health information from localStorage
      function getHealthInfo() {
        const healthInfo = JSON.parse(localStorage.getItem("healthInfo")) || {};
        return healthInfo.include_health ? healthInfo : null;
      }

      // Attach form submission handlers
      handleFormSubmission(
        "meal-suggestion-form",
        "/api/meal_suggestion",
        "meal-suggestion-result",
        ["preferences", "dietary_restrictions", "goal", "meal_type", "cuisine"]
      );
      handleFormSubmission(
        "nutrition-analysis-form",
        "/api/nutrition_analysis",
        "nutrition-analysis-result",
        ["meal"]
      );
      // Updated form submission for the dietary advice form
      handleFormSubmission(
        "dietary-advice-form",
        "/api/dietary_advice",
        "dietary-advice-result",
        [
          "current_diet",
          "advice_goal",
          "activity_level",
          "preferred_meal_types",
          "allergies",
        ]
      );

      handleFormSubmission(
        "meal-plan-form",
        "/api/meal_plan",
        "meal-plan-result",
        [
          "plan_preferences",
          "plan_dietary_restrictions",
          "plan_goal",
          "activity_level_plan",
          "plan_cuisine",
          "meal_types_plan",
          "allergies_plan",
        ]
      );
    </script>
  </body>
</html>
